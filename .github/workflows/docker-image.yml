name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checar o código do repositório
      uses: actions/checkout@v3

    # Instalar dependências do backend (api)
    - name: Instalar dependências do backend
      run: |
        cd api  # Entrar no diretório 'api' se o package.json está lá
        npm install

    # Instalar dependências do frontend (se necessário)
    - name: Instalar dependências do frontend
      run: |
        cd blog-frontend  # Entrar no diretório 'blog-frontend' se necessário
        npm install

    # Construir as imagens Docker
    - name: Construir as imagens Docker
      run: |
        docker-compose -f docker-compose.yml build

    # Rodar os testes com Docker
    - name: Rodar os testes com Docker
      run: |
        docker-compose -f docker-compose.yml up -d
        docker-compose -f docker-compose.yml exec api npm test
        docker-compose -f docker-compose.yml down

    # Realizar deploy (opcional)
    - name: Realizar deploy (opcional)
      run: |
        echo "Deploying..."
